webpackJsonp([1],{100:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(27),n=r.n(a),o=r(18),i=r(14);t.default={computed:n()({activeIndex:function(){return this.$route.meta.navbar_active}},r.i(o.a)(["profile","config"])),methods:{handleSelect:function(e){"github"===e?this.config.github&&(window.location.href=this.config.github):"logout"===e?r.i(i.a)("/api/wechat/logout",{method:"POST"}):this.$router.push({name:e})}}}},101:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(50),n=r.n(a),o=r(14);t.default={props:["value","disabled"],data:function(){return{input:this.value}},watch:{value:function(e){this.input=e}},methods:{featchUser:function(e,t){r.i(o.a)("/api/users",{query:{key:e}}).then(function(e){var r=!0,a=!1,o=void 0;try{for(var i,s=n()(e.data);!(r=(i=s.next()).done);r=!0){var l=i.value;l.value=l.name+"("+l.user_id+")"}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}t(e.data.slice(0,5))})},handleSelect:function(e){this.input=e.user_id,this.$emit("user-choise",e.user_id)}}}},102:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{msg:"使用说明"}}}},103:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{msg:"日志记录"}}}},104:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{msg:"用户中心"}}}},105:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(51),n=r.n(a),o=r(27),i=r.n(o),s=r(18),l=r(97),u=(r.n(l),r(14));t.default={data:function(){var e=this,t=function(e,t,a){var n=new Error("请输入有效的域名");r.i(l.isDomain)(t)?a():a(n)},a=function(e,t,a){var n=new Error("请输入有效的 IP 或域名");r.i(l.isDomain)(t)||r.i(l.isIP)(t)?a():a(n)},n=function(e,t,a){var n=new Error("请输入有效的 IP 或域名");!t||r.i(l.isDomain)(t)||r.i(l.isIP)(t)?a():a(n)};return{form:{mark:"",domain:"",target_type:"HTTP",target_domain:"",target_port:"80",hostname:"",ssl:{uploaded:!1,cert:"",key:""},proxy_type:"HTTP_ONLY",is_enabled:!0},rules:{mark:[{required:!0,message:"请输入代理名称",trigger:"change"}],domain:[{required:!0,message:"请输入访问域名",trigger:"change"},{validator:t,trigger:"change"}],target_type:[{required:!0,message:"请选择回源协议",trigger:"change"}],target_domain:[{required:!0,message:"请输入回源地址",trigger:"change"},{validator:a,trigger:"change"}],target_port:[{required:!0,message:"请输入回源端口",trigger:"change"},{validator:function(e,t,a){var n=new Error("请输入有效的端口");r.i(l.isPort)(t)?a():a(n)},trigger:"change"}],hostname:[{validator:n,trigger:"change"}],proxy_type:[{required:!0,message:"请选择代理方式",trigger:"change"},{validator:function(t,r,a){var n=e.form.ssl;["HTTPS_ONLY","BOTH"].indexOf(r)!==-1&&(n.uploaded||n.cert&&n.key||a(new Error("请先填写证书与密钥"))),a()},trigger:"change"}],is_enabled:[{type:"boolean",required:!0,message:"请选择是否启用",trigger:"change"}]},is_loading:!1,is_submit:!1,proxy:{}}},computed:i()({proxy_id:function(){return this.$route.params.proxy_id}},r.i(s.a)(["config","profile"])),created:function(){this.fetchProxy(this.proxy_id)},methods:{fetchProxy:function(e){var t=this;if(!e)return!1;this.is_loading=!0,r.i(u.a)("/api/proxies/"+e).then(function(e){var r=e.data.target.split(":",2),a="HTTP"===e.data.target_type?"80":"443";e.data.target_domain=r[0],e.data.target_port=r[1]||a,e.data.ssl.cert=e.data.ssl.key="",t.config.https_port||(e.data.proxy_type="HTTP_ONLY"),t.form=e.data,t.is_loading=!1}).catch(function(){t.is_loading=!1})},setDefaultTargetPort:function(e){"HTTP"===e&&"443"===this.form.target_port?this.form.target_port="80":"HTTPS"===e&&"80"===this.form.target_port&&(this.form.target_port="443")},onSubmit:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.is_submit=!0;var a="POST",o="/api/proxies",i=n()({},e.form);"HTTP"===i.target_type&&"80"===i.target_port?i.target=i.target_domain:"HTTPS"===i.target_type&&"443"===i.target_port?i.target=i.target_domain:i.target=i.target_domain+":"+i.target_port,i.hostname=i.hostname||i.domain,i.user_id=e.$route.query.user_id,e.proxy_id&&(a="PUT",o="/api/proxies/"+e.proxy_id),r.i(u.a)(o,{method:a,body:i}).then(function(t){e.is_submit=!1,e.$router.push({name:"proxies",query:e.$route.query})}).catch(function(){e.is_submit=!1})})}}}},106:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(50),n=r.n(a),o=r(27),i=r.n(o),s=r(18),l=r(14),u=r(174),c=r.n(u);t.default={data:function(){return{is_loading:!1,proxies:[]}},components:{UserChoise:c.a},computed:i()({user_id:function(){return this.$route.query.user_id||this.profile.user_id}},r.i(s.a)(["config","profile"])),created:function(){this.fetchProxies()},methods:{fetchProxies:function(){var e=this;this.is_loading=!0;var t=this.user_id;r.i(l.a)("/api/proxies",{query:{user_id:t}}).then(function(t){e.is_loading=!1;var r=!0,a=!1,o=void 0;try{for(var i,s=n()(t.data);!(r=(i=s.next()).done);r=!0){var l=i.value;l.target_url=l.target_type.toLowerCase()+"://"+l.target,"HTTP_ONLY"===l.proxy_type?(l.proxy_type_name="HTTP 访问",l.proxy_url="http://"+l.domain,80!==Number(e.config.http_port)&&(l.proxy_url+=":"+e.config.http_port)):("HTTPS_ONLY"===l.proxy_type?l.proxy_type_name="HTTPS 访问":l.proxy_type_name="HTTP 或 HTTPS",l.proxy_url="https://"+l.domain,Number(443!==e.config.https_port)&&(l.proxy_url+=":"+e.config.https_port))}}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}e.proxies=t.data}).catch(function(){e.is_loading=!1})},userChoise:function(e){this.$router.push({query:{user_id:e}})},removeProxies:function(e,t){var a=this,n=t[e];if(!confirm("你确定要删除 【"+n.mark+"】 吗?"))return!1;r.i(l.a)("/api/proxies/"+n.proxy_id,{method:"DELETE"}).then(function(r){t.splice(e,1),a.$notify({title:"删除成功",message:"已成功删除 【"+n.mark+"】",type:"success"})})}},watch:{$route:function(){this.fetchProxies()}}}},107:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{msg:"统计分析"}}}},108:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{msg:"用户管理"}}}},14:function(e,t,r){"use strict";var a=r(112),n=r.n(a),o=r(109),i=r.n(o),s=r(194),l=(r.n(s),r(171)),u=r.n(l),c=r(69),p=r.n(c),f=r(48),d=(r.n(f),function(e){var t=p.a.assign({state:location.href,usertype:"admin"},e);return"https://qy.weixin.qq.com/cgi-bin/loginpage"+u.a.format({query:t})}),m=function(e,t){switch(e){case 401:return location.href=d(t.extra),!0;default:return f.Notification.error({title:"API 请求失败",message:t.message}),!1}};t.a=function(e,t){t=t||{},t.method=t.method||"GET",t.credentials="same-origin",["POST","PUT"].indexOf(t.method.toUpperCase())!==-1&&(t.headers=t.headers||{},t.headers["Content-Type"]="application/json",t.body&&"string"!=typeof body&&(t.body=i()(t.body))),e+=u.a.format({query:t.query}),t.query=void 0;var r=void 0,a=void 0;return fetch(e,t).then(function(e){return r=e.status,e.json()}).then(function(e){if(a=e,r>=400)throw new Error(a.message);return{status:r,data:a}}).catch(function(e){throw"object"!==(void 0===a?"undefined":n()(a))&&(a={message:e.message}),m(r,a),e})}},163:function(e,t){},164:function(e,t){},165:function(e,t){},166:function(e,t){},173:function(e,t,r){r(166);var a=r(3)(r(100),r(190),"data-v-db330e68",null);e.exports=a.exports},174:function(e,t,r){var a=r(3)(r(101),r(189),null,null);e.exports=a.exports},175:function(e,t,r){var a=r(3)(r(102),r(191),null,null);e.exports=a.exports},176:function(e,t,r){var a=r(3)(r(103),r(183),null,null);e.exports=a.exports},177:function(e,t,r){var a=r(3)(r(104),r(185),null,null);e.exports=a.exports},178:function(e,t,r){r(164);var a=r(3)(r(105),r(184),"data-v-556f003b",null);e.exports=a.exports},179:function(e,t,r){r(165);var a=r(3)(r(106),r(188),"data-v-cbae7e1e",null);e.exports=a.exports},180:function(e,t,r){var a=r(3)(r(107),r(186),null,null);e.exports=a.exports},181:function(e,t,r){var a=r(3)(r(108),r(182),null,null);e.exports=a.exports},182:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",[e._v(e._s(e.msg))])},staticRenderFns:[]}},183:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",[e._v(e._s(e.msg))])},staticRenderFns:[]}},184:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"代理名称",prop:"mark"}},[r("el-input",{attrs:{placeholder:"反向代理名称，便于识别与区分"},model:{value:e.form.mark,callback:function(t){e.form.mark=t},expression:"form.mark"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"访问域名",prop:"domain"}},[r("el-input",{attrs:{placeholder:"用作反向代理的域名，如：example.com"},model:{value:e.form.domain,callback:function(t){e.form.domain=t},expression:"form.domain"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"回源地址",required:""}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"target_type"}},[r("el-select",{attrs:{placeholder:"回源协议"},on:{change:e.setDefaultTargetPort},model:{value:e.form.target_type,callback:function(t){e.form.target_type=t},expression:"form.target_type"}},[r("el-option",{attrs:{label:"http://",value:"HTTP"}}),e._v(" "),r("el-option",{attrs:{label:"https://",value:"HTTPS"}})],1)],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"target_domain"}},[r("el-input",{attrs:{placeholder:"IP 或域名"},model:{value:e.form.target_domain,callback:function(t){e.form.target_domain=t},expression:"form.target_domain"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"target_port"}},[r("el-input",{attrs:{type:"number",placeholder:"端口"},model:{value:e.form.target_port,callback:function(t){e.form.target_port=t},expression:"form.target_port"}})],1)],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"回源 Host",prop:"hostname"}},[r("el-input",{attrs:{placeholder:"HTTP Header 中的 Host，默认为访问域名"},model:{value:e.form.hostname,callback:function(t){e.form.hostname=t},expression:"form.hostname"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.config.https_port,expression:"config.https_port"}],attrs:{label:"HTTPS 证书"}},[r("el-input",{attrs:{type:"textarea",placeholder:e.form.ssl.uploaded?"已上传证书，如需更换请输入新证书":"请填写证书，可选"},model:{value:e.form.ssl.cert,callback:function(t){e.form.ssl.cert=t},expression:"form.ssl.cert"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.config.https_port,expression:"config.https_port"}],attrs:{label:"HTTPS 密钥"}},[r("el-input",{attrs:{type:"textarea",placeholder:e.form.ssl.uploaded?"已上传密钥，如需更换请输入新密钥":"请填写密钥，可选"},model:{value:e.form.ssl.key,callback:function(t){e.form.ssl.key=t},expression:"form.ssl.key"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.config.https_port,expression:"config.https_port"}],attrs:{label:"访问方式",prop:"proxy_type"}},[r("el-radio-group",{model:{value:e.form.proxy_type,callback:function(t){e.form.proxy_type=t},expression:"form.proxy_type"}},[r("el-radio",{attrs:{label:"HTTP_ONLY"}},[e._v("仅 HTTP")]),e._v(" "),r("el-radio",{attrs:{label:"HTTPS_ONLY"}},[e._v("仅 HTTPS")]),e._v(" "),r("el-radio",{attrs:{label:"BOTH"}},[e._v("HTTP 或 HTTPS")])],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"是否启用",prop:"is_enabled"}},[r("el-switch",{attrs:{"on-text":"开","off-text":"关"},model:{value:e.form.is_enabled,callback:function(t){e.form.is_enabled=t},expression:"form.is_enabled"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary",loading:e.is_submit},on:{click:e.onSubmit}},[e._v("\n      "+e._s(this.proxy_id?"提交更新":"立即创建")+"\n    ")]),e._v(" "),r("router-link",{directives:[{name:"show",rawName:"v-show",value:!e.is_submit,expression:"!is_submit"}],attrs:{to:{name:"proxies",query:e.$route.query}}},[r("el-button",[e._v("取消")])],1)],1)],1)},staticRenderFns:[]}},185:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",[e._v(e._s(e.msg))])},staticRenderFns:[]}},186:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",[e._v(e._s(e.msg))])},staticRenderFns:[]}},187:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Navbar"),e._v(" "),r("div",{staticClass:"container"},[r("router-view")],1)],1)},staticRenderFns:[]}},188:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"topbar"},[r("user-choise",{attrs:{value:e.user_id,disabled:!e.profile.is_admin},on:{"user-choise":e.userChoise}}),e._v(" "),r("router-link",{attrs:{to:{name:"proxies-add",query:{user_id:e.user_id}}}},[r("el-button",{attrs:{type:"primary",icon:"fa-plus"}},[e._v("添加")])],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.is_loading,expression:"is_loading"}],attrs:{data:e.proxies,stripe:"",border:""}},[r("el-table-column",{attrs:{align:"center",label:"状态"},scopedSlots:e._u([["default",function(e){return[e.row.is_enabled?r("i",{staticClass:"el-icon-fa-toggle-on"}):r("i",{staticClass:"el-icon-fa-toggle-off"})]}]])}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"mark",label:"名称",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"proxy_type_name",label:"访问方式",sortable:""}}),e._v(" "),r("el-table-column",{attrs:{align:"center",prop:"domain",label:"访问域名",sortable:""},scopedSlots:e._u([["default",function(t){return[r("a",{attrs:{href:t.row.proxy_url,target:"_blank"}},[e._v(e._s(t.row.domain))])]}]])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"回源地址",sortable:""},scopedSlots:e._u([["default",function(t){return[r("a",{attrs:{href:t.row.target_url,target:"_blank"}},[e._v(e._s(t.row.target))])]}]])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([["default",function(t){return[r("router-link",{attrs:{to:{name:"stats",query:{proxy_id:t.row.proxy_id}}}},[r("el-button",{attrs:{size:"small",type:"info"}},[e._v("统计")])],1),e._v(" "),r("router-link",{attrs:{to:{name:"proxies-edit",params:{proxy_id:t.row.proxy_id},query:{user_id:e.user_id}}}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v("编辑")])],1),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){e.removeProxies(t.$index,e.proxies)}}},[e._v("删除")])]}]])})],1)],1)},staticRenderFns:[]}},189:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-autocomplete",{attrs:{"fetch-suggestions":e.featchUser,disabled:e.disabled,placeholder:"请输入用户名",icon:"fa-user"},on:{select:e.handleSelect},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})},staticRenderFns:[]}},190:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"navbar"},[r("div",{staticClass:"container"},[r("el-menu",{attrs:{theme:"dark",mode:"horizontal","default-active":e.activeIndex},on:{select:e.handleSelect}},[r("el-menu-item",{attrs:{index:"proxies"}},[e._v("代理列表")]),e._v(" "),r("el-menu-item",{directives:[{name:"show",rawName:"v-show",value:e.profile.is_admin,expression:"profile.is_admin"}],attrs:{index:"users"}},[e._v("用户管理")]),e._v(" "),r("el-menu-item",{attrs:{index:"stats"}},[e._v("统计分析")]),e._v(" "),r("el-menu-item",{attrs:{index:"logs"}},[e._v("日志记录")]),e._v(" "),r("el-submenu",{staticClass:"right",attrs:{index:"me"}},[r("template",{slot:"title"},[e.profile.avatar?r("img",{staticClass:"avatar",attrs:{src:e.profile.avatar}}):r("i",{staticClass:"el-icon-fa-user el-icon-fa-2x"})]),e._v(" "),r("el-menu-item",{attrs:{index:"profile"}},[e._v("个人中心")]),e._v(" "),r("el-menu-item",{attrs:{index:"logout"}},[e._v("注销登录")])],2),e._v(" "),r("el-menu-item",{staticClass:"right",attrs:{index:"github"}},[r("i",{staticClass:"el-icon-fa-github el-icon-fa-2x",attrs:{"aria-hidden":"true"}})]),e._v(" "),r("el-menu-item",{staticClass:"right",attrs:{index:"help"}},[r("i",{staticClass:"el-icon-fa-book el-icon-fa-2x",attrs:{"aria-hidden":"true"}})])],1)],1)])},staticRenderFns:[]}},191:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",[e._v(e._s(e.msg))])},staticRenderFns:[]}},72:function(e,t,r){"use strict";var a=r(2),n=r(192),o=r(179),i=r.n(o),s=r(178),l=r.n(s),u=r(181),c=r.n(u),p=r(180),f=r.n(p),d=r(176),m=r.n(d),_=r(175),v=r.n(_),h=r(177),g=r.n(h);a.default.use(n.a),t.a=new n.a({mode:"history",routes:[{path:"/",redirect:{name:"proxies"}},{path:"/proxies",name:"proxies",component:i.a,meta:{title:"代理列表",navbar_active:"proxies"}},{path:"/proxies/add",name:"proxies-add",component:l.a,meta:{title:"添加代理",navbar_active:"proxies"}},{path:"/proxies/:proxy_id/edit",name:"proxies-edit",component:l.a,meta:{title:"编辑代理",navbar_active:"proxies"}},{path:"/users",name:"users",component:c.a,meta:{title:"用户管理",navbar_active:"users"}},{path:"/stats",name:"stats",component:f.a,meta:{title:"统计分析",navbar_active:"stats"}},{path:"/logs",name:"logs",component:m.a,meta:{title:"日志分析",navbar_active:"logs"}},{path:"/profile",name:"profile",component:g.a,meta:{title:"个人中心",navbar_active:"profile"}},{path:"/help",name:"help",component:v.a,meta:{title:"使用说明",navbar_active:"help"}}]})},73:function(e,t,r){"use strict";var a=r(2),n=r(18);a.default.use(n.b),t.a=new n.b.Store({state:{profile:{},config:{}},getters:{getProfile:function(e){return e.profile},getConfig:function(e){return e.config}},mutations:{setProfile:function(e,t){e.profile=t},setConfig:function(e,t){e.config=t}},actions:{setProfile:function(e,t){(0,e.commit)("setProfile",t)},setConfig:function(e,t){(0,e.commit)("setConfig",t)}}})},74:function(e,t,r){var a=r(3)(r(99),r(187),null,null);e.exports=a.exports},97:function(e,t){t.isDomain=function(e){return/^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/.test(e)},t.isIP=function(e){return/^(?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))$/.test(e)},t.isPort=function(e){return e&&e>=0&&e<=65535}},98:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),n=r(48),o=r.n(n),i=r(74),s=r.n(i),l=r(72),u=r(73);a.default.config.productionTip=!1,a.default.use(o.a);l.a.beforeEach(function(e,t,r){document.title=e.meta.title+" - 简易反向代理",r()}),new a.default({el:"#app",store:u.a,router:l.a,template:"<App/>",components:{App:s.a}})},99:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(163),n=(r.n(a),r(69)),o=(r.n(n),r(18)),i=r(14),s=r(173),l=r.n(s);t.default={components:{Navbar:l.a},computed:r.i(o.a)(["profile","config"]),created:function(){this.fetchProfile(),this.fetchConfig()},methods:{fetchProfile:function(){var e=this;if(!r.i(n.isEmpty)(this.profile))return!0;r.i(i.a)("/api/profile").then(function(t){e.$store.dispatch("setProfile",t.data)})},fetchConfig:function(){var e=this;if(!r.i(n.isEmpty)(this.config))return!0;r.i(i.a)("/api/config").then(function(t){e.$store.dispatch("setConfig",t.data)})}}}}},[98]);
//# sourceMappingURL=app.3beab4f8ff9fb15dc5d9.js.map